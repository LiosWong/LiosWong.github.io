---
title: 关于近两次生产问题思考
date: 2022-07-21 00:52:42
tags:
- 故障
- 复盘
categories:
- 生产问题  
---

复盘下最近两次生产问题，我也是全程参与并定位到问题，问题比较棘手复杂隐晦，难于发现。

### 更新缓存2022/6/8
* 背景
由于上午已经出了一个故障，下午在做预发与生产的数据隔离，所以隔离工作需要在当天完成，记得大概晚上9点多，计划回家了，一个同事在说数据有丢失的问题，通过接口查询确实有问题，通过定位代码也没发现，喊我过去帮忙一起排查。了解大概情况后，从代码入手，看调用链路代码是否有过改动，看了几遍没发现什么问题，
根据可能出问题的点，一层层看下去，在conver层，会把DO转化成DTO，DTO构造器里会把查出来的feature转换成map（另外一个同事新加逻辑）,由于初始化时feature还是空，所以会new出来一个空featureMap对象，该接口的逻辑是先查缓存，缓存为空，再查数据库再更新缓存，这样会导致缓存里featureMap是空的，进而影响业务。
* 总结
更新缓存时，保证更新值的正确性


### 2022/7/6
* 背景  
